---
title: "Assignment 2.3"
author: "Scout Leonard, Clarissa Boyajian, Alex Yousefivand"
date: "10/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, echo = FALSE}
library(dataRetrieval)
library(tidyverse)
library(metajam)
library(here)
library(censusapi)
library(janitor)
```
## Retieve data using an API


**Note! If you have not run this Rmd on your local computer, run this code chunk initially to download data that is included in .gitignore (aka not stored on GitHub)!**
```{r Use Metajam to Download the Data, eval = FALSE}

download_d1_data(data_url = "https://pasta.lternet.edu/package/data/eml/edi/998/1/406b624e7e71dcd400f677eb70cc8bde", path = ".", dir_name = "data")


```

```{r Get Lead Dataframes}

#load full data package using DataONE API
lead_data_all <- read_d1_files(folder_path = "data")

#pull lead metadata from full lead data package
lead_attribute_metadata <- lead_data_all$attribute_metadata

#pull metadata of the metadata
lead_summary_metadata <- lead_data_all$summary_metadata


#pull actual lead data and tidy
lead_data <- lead_data_all$data %>% 
  clean_names() %>% 
  rename(tract = census_tracts)
#convert tract data from numeric to character for join with census data below
lead_data$tract <- as.character(lead_data$tract)

```

In exploring DataONE, we were interested in environmental justice issues; we looked for data that may be able to answer an environmental justice question. We found that there were several datasets describing environmental and health conditions of Philadelphia neighborhoods. This dataset is one example. Specifically, it gives demographic information in addition to various potential lead poisoning risk factors. 

We downloaded the data and metadata using `metajam`. 

```{r Use Census API to download data}
# Add key to .Renviron
Sys.setenv(CENSUS_KEY = "6d33d69d0552f3b9590804a3c2ab450d2f0ee5f5")

# Reload .Renviron
readRenviron(".Renviron")

# Check to see that the expected key is output in your R console
Sys.getenv("CENSUS_KEY")
```
The step in the code chunk below helped us to look at the datasets in the census package and decise which we wanted to use with the lead data. 
```{r See all APIs}
#census_apis <- listCensusApis()
```

```{r Read in Census Data}

#look at column headers in full census dataset
census_metadata_variable <- listCensusMetadata(
    name = "pdb/tract", 
    vintage = "2021")

#download census data through the API based on geography and variables of interest 
census_data <- getCensus(
    name = "pdb/tract",
    vintage = 2021,
    vars = c("pct_No_Health_Ins_ACS_15_19", "Pop_Disabled_ACS_15_19", "pct_Hispanic_ACS_15_19"), 
    region = "tract:*",
    regionin = "state:42"
    ) %>% 
  filter(county == 101) %>% 
  clean_names()

```

```{r Join Lead Data and Census Data }

#left join lead data and census data by tract 
lead_census_joined <- left_join(x = lead_data, y = census_data, by = "tract")

```

```{r Analysis}

```

