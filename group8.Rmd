---
title: "Assignment 2.3"
author: "Scout Leonard, Clarissa Boyajian, Alex Yousefivand"
date: "10/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, echo = FALSE}
library(dataRetrieval)
library(tidyverse)
library(metajam)
library(here)
library(censusapi)
```
## Retieve data using an API


**Note! If you have not run this Rmd on your local computer, run this code chunk initially to download data that is included in .gitignore (aka not stored on GitHub)!**
```{r Use Metajam to Download the Data, eval = FALSE}

download_d1_data(data_url = "https://pasta.lternet.edu/package/data/eml/edi/998/1/406b624e7e71dcd400f677eb70cc8bde", path = ".", dir_name = "data")


```

```{r}
#Get the dataframes 
lead_data_all <- read_d1_files(folder_path = "data")

lead_attribute_metadata <- lead_data_all$attribute_metadata

lead_summary_metadata <- lead_data_all$summary_metadata

lead_data <- lead_data_all$data

```

In exploring DataONE, we were interested in environmental justice issues; we looked for data that may be able to answer an environmental justice question. We found that there were several datasets describing environmental and health conditions of Philadelphia neighborhoods. This dataset is one example. Specifically, it gives demographic information in addition to various potential lead poisoning risk factors. 

We downloaded the data and metadata using `metajam`. 

```{r Use Census API to download data}
# Add key to .Renviron
Sys.setenv(CENSUS_KEY = "6d33d69d0552f3b9590804a3c2ab450d2f0ee5f5")

# Reload .Renviron
readRenviron(".Renviron")

# Check to see that the expected key is output in your R console
Sys.getenv("CENSUS_KEY")
```

```{r See all APIs}
census_apis <- listCensusApis()
```

```{r Read in Census Data}
census_metadata_variable <- listCensusMetadata(
    name = "pdb/tract", 
    vintage = "2021")

census_data <- getCensus(
    name = "pdb/tract",
    vintage = 2021,
    vars = c("Two_Plus_Health_Ins_ACS_15_19", "Pov_Univ_ACSMOE_15_19", "Civ_noninst_pop_U19_ACSMOE_15_19", "Children_in_Pov_ACSMOE_15_19", "NH_Blk_alone_CEN_2010", "pct_Children_in_Pov_ACSMOE_15_19", "Tract"), 
    region = "tract:*",
    regionin = "state:42"
    ) %>% 
  filter(county == 101)
```

